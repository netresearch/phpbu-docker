# compose.yml - Docker Compose for phpbu
# Usage: docker compose run --rm phpbu --configuration=/config/backup.json

name: phpbu

services:
  phpbu:
    image: ghcr.io/netresearch/phpbu-docker:latest
    build:
      context: .
      dockerfile: Dockerfile
    environment:
      TZ: ${TZ:-UTC}
    volumes:
      - ./config:/config:ro
      - ./backups:/backups
    # Security hardening
    security_opt:
      - no-new-privileges:true
    read_only: true
    cap_drop:
      - ALL
    tmpfs:
      - /tmp:mode=1777,size=64M,noexec,nosuid,nodev

  # Development mode
  dev:
    build:
      context: .
      target: build
    volumes:
      - ./app:/app
      - ./config:/config:ro
      - ./backups:/backups
    command: ["tail", "-f", "/dev/null"]
